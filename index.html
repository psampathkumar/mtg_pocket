<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MTG Pocket â€“ Holo Tilt</title>
<style>
body{margin:0;font-family:Inter,system-ui,Arial;background:radial-gradient(circle at top,#1b1b2f,#05050a);color:#fff}
header{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:rgba(0,0,0,.6);backdrop-filter:blur(6px)}
button{background:linear-gradient(135deg,#4facfe,#00f2fe);border:none;border-radius:10px;padding:.6rem 1rem;font-weight:600;cursor:pointer;transition:transform .2s}
button:active{transform:scale(0.95)}
button:disabled{opacity:.4;cursor:default}
select{background:#111;color:#fff;border-radius:8px;padding:.4rem;border:1px solid #333}
.controls{display:flex;gap:1rem;flex-wrap:wrap;padding:1rem}
.stats{padding:1rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem}
.statBox{background:#111;padding:1rem;border-radius:12px}
.progress{height:8px;background:#222;border-radius:6px;overflow:hidden;margin-top:6px}
.progress div{height:100%;background:linear-gradient(90deg,#4facfe,#00f2fe)}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1rem;padding:1rem}
.card{position:relative;background:#111;border-radius:16px;overflow:hidden;cursor:pointer;transform-style:preserve-3d;transition:transform 0.2s ease,filter 0.3s ease,box-shadow 0.3s ease;will-change:transform,filter}
.card img{width:100%;display:block;border-radius:14px}
.card:hover{box-shadow:0 20px 40px rgba(0,0,0,.6);filter:drop-shadow(0 0 10px #4facfe)}
.count{position:absolute;bottom:6px;right:6px;background:rgba(0,0,0,.7);padding:2px 6px;border-radius:8px;font-size:.75rem}
.foil{position:absolute;inset:0;background:linear-gradient(120deg,transparent 20%,rgba(255,255,255,.35),transparent 80%);mix-blend-mode:screen;animation:foil 3s linear infinite;border-radius:16px}
.new-card{outline:3px solid #ffd700;}
.new-card::after{content:'NEW';position:absolute;top:4px;left:4px;background:#ffd700;color:#000;font-weight:700;padding:0 4px;border-radius:4px;font-size:0.65rem;}
@keyframes foil{from{background-position:0%}to{background-position:200%}}
.rarity-common{border:2px solid #999}
.rarity-uncommon{border:2px solid #1eff00}
.rarity-rare{border:2px solid #0070dd}
.rarity-mythic{border:2px solid #ff8000}
#packModal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;overflow:auto;z-index:1000}
.packCards{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;max-width:90%;}
.packCards .card{flex:1 1 calc(20% - 1rem);max-width:180px}
#cardViewModal{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:2000;perspective:1000px}
#cardViewModal .card{max-width:300px;max-height:450px;cursor:grab;transition:transform .2s ease, filter .3s ease, box-shadow .3s ease;will-change:transform, filter}
</style>
</head>
<body>
<header>
  <h1>MTG Pocket</h1>
  <div>Points: <b id="points">0</b> <button id="openPack">Open Pack (6)</button></div>
</header>
<div class="controls">
  <label style="display:flex;align-items:center;gap:.4rem">
    <input type="checkbox" id="freeMode"> Free Packs
  </label>
  <label>Set:
    <select id="setSelect"></select>
  </label>
</div>
<div class="stats" id="stats"></div>
<div id="collection" class="cards"></div>
<div id="packModal"><div id="pack" class="pack">RIP</div></div>
<div id="cardViewModal"></div>
<script>
const PACK_COST=6,INTERVAL=3600000,FOIL_CHANCE=0.03;
let data=JSON.parse(localStorage.getItem('mtgPocket'))||{points:0,last:Date.now(),cards:{}};
let allCards=[],currentSet=null,setSize=0;

function save(){localStorage.setItem('mtgPocket',JSON.stringify(data))}

function enableHoloTilt(el){
 function tilt(x,y){
   el.style.transform=`perspective(1000px) rotateX(${-y*20}deg) rotateY(${x*20}deg) scale(1.05)`;
   el.style.filter=`hue-rotate(${x*20}deg) saturate(1.2)`;
 }
 el.addEventListener('mousemove',e=>{
   const r=el.getBoundingClientRect();
   const x=(e.clientX-r.left)/r.width-.5;
   const y=(e.clientY-r.top)/r.height-.5;
   tilt(x,y);
 });
 el.addEventListener('touchmove',e=>{
   const t=e.touches[0];
   const r=el.getBoundingClientRect();
   const x=(t.clientX-r.left)/r.width-.5;
   const y=(t.clientY-r.top)/r.height-.5;
   tilt(x,y);
 });
 el.addEventListener('mouseleave',()=>{el.style.transform='';el.style.filter='';});
 el.addEventListener('touchend',()=>{el.style.transform='';el.style.filter='';});
}

async function loadSets(){
 const r=await fetch('https://api.scryfall.com/sets');
 const j=await r.json();
 let sets = j.data.filter(s=>s.released_at && s.card_count>100 && !s.name.toLowerCase().includes('jumpstart') && !s.name.toLowerCase().includes('promo') && !/Commander\s*$/i.test(s.name));
 sets.sort((a,b)=>new Date(b.released_at)-new Date(a.released_at));
 const sel=document.getElementById('setSelect');
 sets.forEach(s=>{
   const o=document.createElement('option');
   o.value=s.code;o.textContent=`${s.name} (${s.code.toUpperCase()})`;
   sel.appendChild(o);
 });
 currentSet=sel.value;
}

async function loadSet(){
 let res=await fetch(`https://api.scryfall.com/cards/search?q=set:${currentSet}+game:paper&unique=cards`);
 let j=await res.json();
 allCards=j.data.filter(c=>c.image_uris&&['common','uncommon','rare','mythic'].includes(c.rarity));
 setSize=allCards.length;
}

function tick(){
 let h=Math.floor((Date.now()-data.last)/INTERVAL);
 if(h>0){data.points+=h;data.last+=h*INTERVAL;save()}
 update();
}

function roll(){let r=Math.random()*100;if(r<1)return'mythic';if(r<10)return'rare';if(r<30)return'uncommon';return'common'}

async function openPack(){
 const free=document.getElementById('freeMode').checked;
 if(!free && data.points<PACK_COST) return;
 if(!currentSet) await loadSets();
 await loadSet();
 if(!free) data.points-=PACK_COST;
 let pack=[];
 data.cards[currentSet]=data.cards[currentSet]||{};
 for(let i=0;i<5;i++){
   let rarity=roll();
   let pool=allCards.filter(c=>c.rarity===rarity);
   let card=pool[Math.floor(Math.random()*pool.length)];
   let id=card.id+(Math.random()<FOIL_CHANCE?'_foil':'');
   let foil=id.endsWith('_foil');
   let isNew=!data.cards[currentSet][id];
   data.cards[currentSet][id]=data.cards[currentSet][id]||{name:card.name,rarity:card.rarity,img:card.image_uris.normal,count:0,foil,isNew};
   data.cards[currentSet][id].count++;
   pack.push(data.cards[currentSet][id]);
 }
 save();
 showPack(pack);
 update();
}

function showPack(pack){
 const m=document.getElementById('packModal');
 m.style.display='flex';
 m.innerHTML='<div class="packCards"></div>';
 const container=document.querySelector('.packCards');
 pack.forEach(c=>{
  const cardDiv=document.createElement('div');
  cardDiv.className='card rarity-'+c.rarity+(c.isNew?' new-card':'');
  cardDiv.innerHTML=`<img src="${c.img}"><div class="count">x${c.count}</div>`;
  if(c.foil) cardDiv.innerHTML+='<div class="foil"></div>';
  enableHoloTilt(cardDiv);
  cardDiv.onclick=()=>showCardView(c);
  container.appendChild(cardDiv);
  c.isNew=false;
 });
 m.onclick=()=>{m.style.display='none'; m.innerHTML='<div id="pack" class="pack">RIP</div>'};
}

function showCardView(card){
 const m=document.getElementById('cardViewModal');
 m.style.display='flex';
 m.innerHTML='';
 const cardDiv=document.createElement('div');
 cardDiv.className='card rarity-'+card.rarity;
 cardDiv.innerHTML=`<img src="${card.img}"><div class="count">x${card.count}</div>`;
 if(card.foil) cardDiv.innerHTML+='<div class="foil"></div>';
 enableHoloTilt(cardDiv);
 m.appendChild(cardDiv);
 m.onclick=()=>{m.style.display='none'; m.innerHTML='';};
}

document.getElementById('openPack').onclick=openPack;
document.getElementById('setSelect').onchange=e=>{currentSet=e.target.value;update();};
document.getElementById('freeMode').onchange=()=>update();

function cardEl(card){
 const d=document.createElement('div');
 d.className=`card rarity-${card.rarity}`;
 d.innerHTML=`<img src="${card.img}"><div class="count">x${card.count}</div>`;
 if(card.foil)d.innerHTML+='<div class="foil"></div>';
 enableHoloTilt(d);
 d.onclick=()=>showCardView(card);
 return d;
}

function render(){
 const col=document.getElementById('collection');
 col.innerHTML='';
 if(!currentSet || !data.cards[currentSet]) return;
 Object.values(data.cards[currentSet]).forEach(c=>col.appendChild(cardEl(c)));
}

function updateStats(){
 if(!currentSet) return;
 const s={common:0,uncommon:0,rare:0,mythic:0};
 Object.values(data.cards[currentSet]||{}).forEach(c=>s[c.rarity]+=c.count);
 document.getElementById('stats').innerHTML=`<div class='statBox'><b>Set Progress</b><div class='progress'><div style='width:${Math.min(100,(Object.keys(data.cards[currentSet]||{}).length/setSize)*100)}%'></div></div></div>`+Object.entries(s).map(([k,v])=>`<div class='statBox'><b>${k.toUpperCase()}</b><br>${v}</div>`).join('');
}

function update(){
 document.getElementById('points').textContent=data.points;
 const free=document.getElementById('freeMode').checked;
 document.getElementById('openPack').disabled=!free && data.points<PACK_COST;
 render();updateStats();
}

loadSets();
tick();
</script>
</body>
</html>
