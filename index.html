<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MTG Pocket â€“ Holo Tilt</title>
<style>
body{margin:0;font-family:Inter,system-ui,Arial;background:radial-gradient(circle at top,#1b1b2f,#05050a);color:#fff}
header{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:rgba(0,0,0,.6);backdrop-filter:blur(6px)}
button{background:linear-gradient(135deg,#4facfe,#00f2fe);border:none;border-radius:10px;padding:.6rem 1rem;font-weight:600;cursor:pointer}
button:disabled{opacity:.4}
select{background:#111;color:#fff;border-radius:8px;padding:.4rem;border:1px solid #333}
.controls{display:flex;gap:1rem;flex-wrap:wrap;padding:1rem;align-items:center}
.stats{padding:1rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem}
.statBox{background:#111;padding:1rem;border-radius:12px;cursor:pointer;text-align:center}
.statBox.active{outline:2px solid #4facfe}
.progress{height:8px;background:#222;border-radius:6px;overflow:hidden;margin-top:6px}
.progress div{height:100%;background:linear-gradient(90deg,#4facfe,#00f2fe)}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1rem;padding:1rem}
.card{position:relative;background:#111;border-radius:16px;overflow:hidden;cursor:pointer;transform-style:preserve-3d;transition:transform .15s,filter .2s,box-shadow .2s}
.card img{width:100%;display:block}
.card:hover{box-shadow:0 20px 40px rgba(0,0,0,.6)}
.count{position:absolute;bottom:6px;right:6px;background:rgba(0,0,0,.7);padding:2px 6px;border-radius:8px;font-size:.75rem}
.foil{position:absolute;inset:0;background:linear-gradient(120deg,transparent 20%,rgba(255,255,255,.35),transparent 80%);mix-blend-mode:screen;animation:foil 3s linear infinite}
.new-card{outline:3px solid #ffd700}
.new-card::after{content:'NEW';position:absolute;top:4px;left:4px;background:#ffd700;color:#000;font-weight:700;padding:0 4px;border-radius:4px;font-size:.65rem}
@keyframes foil{from{background-position:0%}to{background-position:200%}}
.rarity-common{border:2px solid #999}
.rarity-uncommon{border:2px solid #1eff00}
.rarity-rare{border:2px solid #0070dd}
.rarity-mythic{border:2px solid #ff8000}
#packModal,#cardViewModal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:1000}
.packCards{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;max-width:90%}
</style>
</head>
<body>
<header>
  <h1>MTG Pocket</h1>
  <div>Points: <b id="points">0</b> <button id="openPack">Open Pack (6)</button></div>
</header>

<div class="controls">
  <label><input type="checkbox" id="freeMode"> Free Packs</label>
  <label>Set: <select id="setSelect"></select></label>
  <div id="countdown">Next point in: --:--</div>
</div>

<div class="stats" id="stats"></div>
<div id="collection" class="cards"></div>

<div id="packModal"></div>
<div id="cardViewModal"></div>

<script>
const PACK_COST=6,INTERVAL=3600000,FOIL_CHANCE=0.03;
let data=JSON.parse(localStorage.getItem('mtgPocket'))||{points:0,last:Date.now(),cards:{}};
let allCards=[],currentSet=null,setSize=0,activeRarity='all';

function save(){localStorage.setItem('mtgPocket',JSON.stringify(data))}

function enableTilt(el){
 el.onmousemove=e=>{
  const r=el.getBoundingClientRect();
  const x=(e.clientX-r.left)/r.width-.5;
  const y=(e.clientY-r.top)/r.height-.5;
  el.style.transform=`perspective(800px) rotateX(${-y*15}deg) rotateY(${x*15}deg) scale(1.05)`;
 };
 el.onmouseleave=()=>el.style.transform='';
 el.ontouchmove=e=>{
  const t=e.touches[0];const r=el.getBoundingClientRect();
  const x=(t.clientX-r.left)/r.width-.5;
  const y=(t.clientY-r.top)/r.height-.5;
  el.style.transform=`perspective(800px) rotateX(${-y*15}deg) rotateY(${x*15}deg) scale(1.05)`;
 };
 el.ontouchend=()=>el.style.transform='';
}

async function loadSets(){
 const r=await fetch('https://api.scryfall.com/sets');
 const j=await r.json();
 let sets=j.data.filter(s=>s.released_at&&s.card_count>100&&!s.name.toLowerCase().includes('jumpstart')&&!s.name.toLowerCase().includes('promo')&&!/Commander\s*$/i.test(s.name));
 sets.sort((a,b)=>new Date(b.released_at)-new Date(a.released_at));
 const sel=document.getElementById('setSelect');
 sel.innerHTML='';
 sets.forEach(s=>{const o=document.createElement('option');o.value=s.code;o.textContent=s.name;sel.appendChild(o)});
 currentSet=sel.value;
 loadSet();
}

async function loadSet(){
 const res=await fetch(`https://api.scryfall.com/cards/search?q=set:${currentSet}+game:paper&unique=cards`);
 const j=await res.json();
 allCards=j.data.filter(c=>c.image_uris&&['common','uncommon','rare','mythic'].includes(c.rarity));
 setSize=allCards.length;
 render();updateStats();
}

function roll(){let r=Math.random()*100;if(r<1)return'mythic';if(r<10)return'rare';if(r<30)return'uncommon';return'common'}

function tick(){
 const now=Date.now();
 const diff=now-data.last;
 const h=Math.floor(diff/INTERVAL);
 if(h>0){data.points+=h;data.last+=h*INTERVAL;save()}
 const rem=INTERVAL-(now-data.last);
 const m=Math.floor(rem/60000),s=Math.floor(rem%60000/1000);
 document.getElementById('countdown').textContent=`Next point in: ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
 update();
}

async function openPack(){
 const free=document.getElementById('freeMode').checked;
 if(!free&&data.points<PACK_COST) return;
 if(!free) data.points-=PACK_COST;
 data.cards[currentSet]=data.cards[currentSet]||{};
 let pack=[];
 for(let i=0;i<5;i++){
  const rarity=roll();
  const pool=allCards.filter(c=>c.rarity===rarity);
  const card=pool[Math.floor(Math.random()*pool.length)];
  const id=card.id+(Math.random()<FOIL_CHANCE?'_foil':'');
  const foil=id.endsWith('_foil');
  const isNew=!data.cards[currentSet][id];
  data.cards[currentSet][id]=data.cards[currentSet][id]||{name:card.name,rarity:card.rarity,img:card.image_uris.normal,count:0,foil};
  data.cards[currentSet][id].count++;
  pack.push({...data.cards[currentSet][id],isNew});
 }
 save();showPack(pack);update();
}

function showPack(pack){
 const m=document.getElementById('packModal');
 m.style.display='flex';
 m.innerHTML='<div class="packCards"></div>';
 const c=m.firstChild;
 pack.forEach(card=>{
  const d=cardEl(card);
  if(card.isNew) d.classList.add('new-card');
  c.appendChild(d);
 });
 m.onclick=()=>{m.style.display='none';m.innerHTML=''};
}

function cardEl(card){
 const d=document.createElement('div');
 d.className=`card rarity-${card.rarity}`;
 d.innerHTML=`<img src="${card.img}"><div class="count">x${card.count}</div>`;
 if(card.foil) d.innerHTML+='<div class="foil"></div>';
 enableTilt(d);
 d.onclick=e=>{e.stopPropagation();showCard(card)};
 return d;
}

function showCard(card){
 const m=document.getElementById('cardViewModal');
 m.style.display='flex';
 m.innerHTML='';
 const d=cardEl(card);
 d.style.maxWidth='300px';
 m.appendChild(d);
 m.onclick=()=>{m.style.display='none';m.innerHTML=''};
}

function render(){
 const col=document.getElementById('collection');
 col.innerHTML='';
 if(!data.cards[currentSet]) return;
 Object.values(data.cards[currentSet]).forEach(c=>{
  if(activeRarity!=='all'&&c.rarity!==activeRarity) return;
  col.appendChild(cardEl(c));
 });
}

function updateStats(){
 const statsEl=document.getElementById('stats');
 if(!currentSet) return;
 const owned=data.cards[currentSet]||{};
 const counts={common:0,uncommon:0,rare:0,mythic:0};
 Object.values(owned).forEach(c=>counts[c.rarity]+=c.count);
 const totals={common:0,uncommon:0,rare:0,mythic:0};
 allCards.forEach(c=>totals[c.rarity]++);
 statsEl.innerHTML=`
  <div class='statBox' data-rarity='all'><b>All Cards</b><div class='progress'><div style='width:${Math.min(100,Object.keys(owned).length/setSize*100)}%'></div></div></div>
  ${['common','uncommon','rare','mythic'].map(r=>`
   <div class='statBox' data-rarity='${r}'>
     <b>${r.toUpperCase()}</b> ${counts[r]}/${totals[r]}
     <div class='progress'><div style='width:${totals[r]?counts[r]/totals[r]*100:0}%'></div></div>
   </div>`).join('')}
 `;
 statsEl.querySelectorAll('.statBox').forEach(box=>{
  box.onclick=()=>{activeRarity=box.dataset.rarity;render();};
 });
}

function update(){
 document.getElementById('points').textContent=data.points;
 document.getElementById('openPack').disabled=!document.getElementById('freeMode').checked&&data.points<PACK_COST;
 render();updateStats();
}

openPackBtn=document.getElementById('openPack');
openPackBtn.onclick=openPack;
document.getElementById('setSelect').onchange=e=>{currentSet=e.target.value;loadSet()};
document.getElementById('freeMode').onchange=update;

loadSets();
tick();
setInterval(tick,1000);
</script>
</body>
</html>
